graph TD   
    Start["üöÄ **AAID Development Begins**<br/><br/>Prerequisites Complete:<br/><br/>‚Ä¢ **Product Discovery** ‚Üí Specs Ready<br/>‚Ä¢ **Project Setup** ‚Üí Scaffolded & Configured<br/>‚Ä¢ **AAID Loaded** ‚Üí Added Rules and Commands<br/><br/>  (New or Existing Codebase)"]
    
    Start --> ContextPhase["üìö Stage 1: <br> CONTEXT PROVIDING"]
    
    ContextPhase --> C1["Add High-Level Context<br/>(README, architecture docs, code style guide)<br/>@project-context"]
    
    C1 --> BuildChoice{"What are you<br/>building?"}
    
    BuildChoice -->|Domain/Business Logic| C2A["Add Specification Context<br/>(User Stories, BDD Scenarios)"]
    BuildChoice -->|Technical Implementation<br/>Non-Observable| C2B["Add Specification Context<br/>(Technical Tasks, NFRs, Architecture)"]
    BuildChoice -->|Presentation/UI Implementation<br/>Observable| C2C["Add Specification Context<br/>(Design Specs, Figma, Style Guide)"]
    
    C2A --> C3A["Add Relevant Code Context<br/>(Domain Dependencies, Tests, Similar Features)"]
    C2B --> C3B["Add Relevant Code Context<br/>(Adapters, Infrastructure, Integration Points)"]
    C2C --> C3C["Add Relevant Code Context<br/>(Components, Design System, CSS Framework)"]
    
    C3A --> PlanningPhase
    C3B --> PlanningPhase
    C3C --> PlanningPhase
    
    PlanningPhase["ü§ù Stage 2: <br> PLANNING"]
    
    PlanningPhase --> P1["Discuss Feature with AI Agent<br/>(Like with Human Colleague)"]
    
    P1 --> P2{"Does AI Need<br/>More Context?"}
    
    P2 -->|Yes| P3["Provide Additional Context"]
    P2 -->|No| RoadmapChoice
    P3 --> P1
    
    RoadmapChoice{"Select Roadmap Type<br/>Based on Work"}
    
    RoadmapChoice -->|Domain/Business| P4A["Request Feature Roadmap<br/>@ai-roadmap-template<br/>(Save to /ai-roadmaps)"]
    RoadmapChoice -->|Technical Implementation| P4B["Request Technical Roadmap<br/>@ai-technical-roadmap-template<br/>(Save to /ai-roadmaps/technical)"]
    RoadmapChoice -->|Presentation/UI| P4C["Request Presentation Roadmap<br/>@ai-presentation-roadmap-template<br/>(Save to /ai-roadmaps/presentation)"]
    
    P4A --> P5["üìã Review Roadmap Carefully"]
    P4B --> P5
    P4C --> P5
    
    P5 --> P6{"Is Roadmap Good &<br/>Aligned with Requirements?"}
    
    P6 -->|No| P7["Refine Roadmap with AI"]
    P7 --> RoadmapChoice
    
    P6 -->|Yes| DevPath{"Development Path?"}
    
    DevPath -->|Domain/Business or<br/>Technical Implementation| TDDPhase
    DevPath -->|Presentation/UI| PresImplementation
    
    %% PRESENTATION PATH (No TDD)
    PresImplementation["üé® IMPLEMENT<br/>No TDD - Implement per Design Specs<br/>(Follow Team Standards)"]
    
    PresImplementation --> PresValidation["üëÅÔ∏è VALIDATE<br/>(Manual Review, Accessibility, Responsiveness<br/>Visual Tests as Needed)"]
    
    PresValidation --> PresComplete["‚ú® Feature Complete<br/>(Presentation Validated)<br/>Ready for Deployment Pipeline"]
    
    %% TDD PATH (Domain/Business and Technical Implementation)
    TDDPhase["üìù Stage 3: <br> TDD DEVELOPMENT STARTS"]
    
    TDDPhase --> InitChoice{"Choose TDD<br/>Approach"}
    
    InitChoice -->|Test List| TL1["Create Complete Test List<br/>(Markdown or Skipped Tests)"]
    InitChoice -->|Single Test| ST1["Write Simplest First Test"]
    
    TL1 --> TL2["Review Against Specifications"]
    ST1 --> CycleStart
    TL2 --> CycleStart
    
    CycleStart["üîÑ Stage 4: <br> THE TDD CYCLE<br/>(RED GREEN REFACTOR Per Test)"]
    
    %% RED PHASE
    CycleStart --> Red["üî¥ RED PHASE: Write Failing Test"]
    Red --> R1["Collaborate with AI to Write Test<br/>(@red-&-stop)"]
    R1 --> R2{"Did test fail<br/>as expected?"}
    R2 -->|Yes| RedReview
    R2 -->|No| R3["Debug/Fix test until it fails correctly<br/>"]
    R3 --> R1
    
    RedReview["‚è∏Ô∏è  AWAIT USER REVIEW (RED PHASE)<br/><b>AI MUST STOP HERE</b>"]
    RedReview --> RedApprove{"Approve<br/>RED Phase?"}
    RedApprove -->|No| R1
    RedApprove -->|Yes| Green
    
    %% GREEN PHASE
    Green["üü¢ GREEN PHASE: Make Test Pass"]
    Green --> G1["Collaborate with AI to Write Code<br/>(@green-&-stop)"]
    G1 --> G2{"Did all tests pass?"}
    G2 -->|Yes| GreenReview
    G2 -->|No| G3["Debug/Fix code until test passes<br/>"]
    G3 --> G1
    
    GreenReview["‚è∏Ô∏è  AWAIT USER REVIEW (GREEN PHASE)<br/><b>AI MUST STOP HERE</b>"]
    GreenReview --> GreenApprove{"Approve<br/>GREEN Phase?"}
    GreenApprove -->|No| G1
    GreenApprove -->|Yes| Refactor
    
    %% REFACTOR PHASE
    Refactor["üßº REFACTOR PHASE: Improve Code"]
    Refactor --> RF1["Collaborate with AI to Refactor<br/>(@refactor-&-stop)"]
    RF1 --> RF2{"Do all tests still pass?"}
    RF2 -->|Yes| RefactorReview
    RF2 -->|No| RF3["AI stops. User chooses:<br/>Fix issue or revert to green<br/>"]
    RF3 --> RF1
    
    RefactorReview["‚è∏Ô∏è  AWAIT FINAL USER REVIEW (REFACTOR PHASE)<br/><b>AI MUST STOP HERE</b>"]
    RefactorReview --> RefactorApprove{"Approve<br/>REFACTOR Phase?"}
    RefactorApprove -->|No| RF1
    RefactorApprove -->|Yes| NextTest
    
    %% ITERATION OR COMPLETION
    NextTest{"More Tests<br/>Needed?"}
    NextTest -->|Yes, Test List| PickNext["üìå Select Next Test from List<br/><i>Return to RED Phase<br/>with next test</i>"]
    NextTest -->|Yes, Single| CreateNext["üìù Design Next Test Case<br/><i>Return to RED Phase<br/>with new test</i>"]
    NextTest -->|No| Complete
    
    Complete["‚ú® Feature Complete<br/>(All Tests Green for This Feature)"] 
    
    Complete --> Deploy["üì¶ Ready for Deployment Pipeline"]
    
    %% STYLES
    style Start fill:#f9f9f9,stroke:#333,stroke-width:3px,color:#000
    style ContextPhase fill:#1976d2,stroke:#0d47a1,stroke-width:3px,color:#fff
    style C1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style BuildChoice fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style C2A fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style C2B fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style C2C fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style C3A fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style C3B fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style C3C fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style PlanningPhase fill:#f57c00,stroke:#e65100,stroke-width:3px,color:#fff
    style P1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P2 fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P3 fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style RoadmapChoice fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P4A fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P4B fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P4C fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P5 fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P6 fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style P7 fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style DevPath fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style PresImplementation fill:#e1bee7,stroke:#7b1fa2,stroke-width:3px,color:#000
    style PresValidation fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style PresComplete fill:#ba68c8,stroke:#7b1fa2,stroke-width:3px,color:#fff
    style TDDPhase fill:#388e3c,stroke:#1b5e20,stroke-width:3px,color:#fff
    style InitChoice fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    style TL1 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    style TL2 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    style ST1 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    style CycleStart fill:#7b1fa2,stroke:#4a148c,stroke-width:3px,color:#fff
    style Red fill:#ffebee,stroke:#d32f2f,stroke-width:3px,color:#000
    style R1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    style R2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    style R3 fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    style RedReview fill:#fff9c4,stroke:#f9a825,stroke-width:4px,color:#000
    style RedApprove fill:#fff9c4,stroke:#f9a825,stroke-width:2px,color:#000
    style Green fill:#c8e6c9,stroke:#388e3c,stroke-width:3px,color:#000
    style G1 fill:#c8e6c9,stroke:#388e3c,stroke-width:2px,color:#000
    style G2 fill:#c8e6c9,stroke:#388e3c,stroke-width:2px,color:#000
    style G3 fill:#c8e6c9,stroke:#388e3c,stroke-width:2px,color:#000
    style GreenReview fill:#fff9c4,stroke:#f9a825,stroke-width:4px,color:#000
    style GreenApprove fill:#fff9c4,stroke:#f9a825,stroke-width:2px,color:#000
    style Refactor fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000
    style RF1 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    style RF2 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    style RF3 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    style RefactorReview fill:#fff9c4,stroke:#f9a825,stroke-width:4px,color:#000
    style RefactorApprove fill:#fff9c4,stroke:#f9a825,stroke-width:2px,color:#000
    style NextTest fill:#f5f5f5,stroke:#666,stroke-width:2px,color:#000
    style PickNext fill:#fef9e7,stroke:#f9a825,stroke-width:2px,color:#000
    style CreateNext fill:#fef9e7,stroke:#f9a825,stroke-width:2px,color:#000
    style Complete fill:#4caf50,stroke:#2e7d32,stroke-width:3px,color:#fff
    style Deploy fill:#4caf50,stroke:#2e7d32,stroke-width:3px,color:#fff
    
    %% ARROW COLORS
    %% Blue for Domain/Business Logic paths (and shared paths)
    linkStyle 0,1,2,3 stroke:#1976d2,stroke-width:3px
    linkStyle 6,9,10,11,12,13,14,15,16 stroke:#1976d2,stroke-width:3px
    linkStyle 17 stroke:#1976d2,stroke-width:3px
    linkStyle 20,23,24,25,26,27 stroke:#1976d2,stroke-width:3px
    linkStyle 29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65 stroke:#1976d2,stroke-width:3px
    
    %% Orange for Technical Implementation specific paths
    linkStyle 4,7,10 stroke:#f57c00,stroke-width:3px
    linkStyle 18,21 stroke:#f57c00,stroke-width:3px
    
    %% Purple for Presentation/UI specific paths
    linkStyle 5,8,11 stroke:#7b1fa2,stroke-width:3px
    linkStyle 19,22,28,29,30 stroke:#7b1fa2,stroke-width:3px