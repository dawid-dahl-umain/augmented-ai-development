graph TD
    Legend["📖 LEGEND<br/>────────<br/>**IPD**: In-Process Dependency<br/><br/>**OOPD**: Out-of-Process Dependency<br/><br/>**Answers:**<br/><br/>**✓ Real**: Use actual dependency<br/>**⊗ Mock**: Use test double<br/>**⇄ Toggleable**: Mock dev, real verify<br/>**N/A**: Not applicable<br/><br/>**Note:** 'or' indicates context-dependent choice<br/>(stability, team preference, test reliability)"]
    
    Start["❓ Should I mock this dependency?"]
    
    Legend --> Start
    
    Start --> Q1{"What are you building?"}
    
    Q1 -->|Observable Behavioral| Q2A["Which test type?"]
    Q1 -->|Non-Observable Technical| Q2B["Which test type?"]
    Q1 -->|Observable Technical| VisualAnswer["👁️ Visual/Sensory Validation<br/>────────<br/>No mocking applicable"]
    
    Q2A --> UnitTest["🔬 Unit Test"]
    Q2A --> AcceptanceTest["🎯 Acceptance Test"]
    
    Q2B --> IntegrationTest["🔌 Integration Test"]
    Q2B --> ContractChoice{"Which Unmanaged<br/>OOPD type?"}
    
    ContractChoice -->|Governed Unmanaged| BiContract["🤝 Bidirectional Contract"]
    ContractChoice -->|External Unmanaged| UniContract["➡️ Unidirectional Contract"]
    
    UnitTest --> UnitQ{"What's the dependency?"}
    UnitQ -->|🟣 Pure IPD| UnitA1["✓ Real<br/>(deterministic, safe)"]
    UnitQ -->|🟠 Impure IPD| UnitA2["⊗ Mock<br/>(side effects)"]
    UnitQ -->|🟢 Managed OOPD| UnitA3["⊗ Mock<br/>(external resource)"]
    UnitQ -->|🔵 Unmanaged OOPD| UnitA4["⊗ Mock<br/>(external service)"]
    
    IntegrationTest --> IntQ{"What's the dependency?"}
    IntQ -->|🟣 Pure IPD| IntA1["✓ Real<br/>(deterministic, safe)"]
    IntQ -->|🟠 Impure IPD| IntA2["✓ Real or ⊗ Mock<br/>(if stable)"]
    IntQ -->|🟢 Managed OOPD| IntA3["✓ Real<br/>(testing this contract!)"]
    IntQ -->|🔵 Unmanaged OOPD| IntA4["⊗ Mock<br/>(not adapter's focus)"]
    
    BiContract --> BiQ{"What's the dependency?"}
    BiQ -->|🟣 Pure IPD| BiA1["✓ Real"]
    BiQ -->|🟠 Impure IPD| BiA2["⊗ Mock"]
    BiQ -->|🟢 Managed OOPD| BiA3["N/A<br/>(no managed deps)"]
    BiQ -->|🔵 Governed Unmanaged OOPD| BiA4["⇄ Toggleable<br/>(mock dev, real verify)"]
    BiQ -->|🔵 External Unmanaged OOPD| BiA5["N/A<br/>(not applicable)"]
    
    UniContract --> UniQ{"What's the dependency?"}
    UniQ -->|🟣 Pure IPD| UniA1["✓ Real"]
    UniQ -->|🟠 Impure IPD| UniA2["⊗ Mock"]
    UniQ -->|🟢 Managed OOPD| UniA3["N/A<br/>(no managed deps)"]
    UniQ -->|🔵 Governed Unmanaged OOPD| UniA4["N/A<br/>(not applicable)"]
    UniQ -->|🔵 External Unmanaged OOPD| UniA5["⇄ Toggleable<br/>(mock dev, minimal checks)"]
    
    AcceptanceTest --> AccQ{"What's the dependency?"}
    AccQ -->|🟣 Pure IPD| AccA1["✓ Real<br/>(part of system)"]
    AccQ -->|🟠 Impure IPD| AccA2["✓ Real<br/>(part of system)"]
    AccQ -->|🟢 Managed OOPD| AccA3["✓ Real<br/>(all managed deps!)"]
    AccQ -->|🔵 Unmanaged OOPD| AccA4["⊗ Mock<br/>(system isolation)"]
    
    style Legend fill:#fff9c4,stroke:#f9a825,stroke-width:3px,color:#000
    style Start fill:#f9f9f9,stroke:#333,stroke-width:3px,color:#000
    style Q1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style Q2A fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style Q2B fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style ContractChoice fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    
    style UnitTest fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style IntegrationTest fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    style BiContract fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style UniContract fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    style AcceptanceTest fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    style VisualAnswer fill:#f5f5f5,stroke:#666,stroke-width:2px,color:#000
    
    style UnitQ fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style IntQ fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    style BiQ fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    style UniQ fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    style AccQ fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    
    style UnitA1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style UnitA2 fill:#ffe0b2,stroke:#f57c00,stroke-width:2px,color:#000
    style UnitA3 fill:#c8e6c9,stroke:#388e3c,stroke-width:2px,color:#000
    style UnitA4 fill:#bbdefb,stroke:#1976d2,stroke-width:2px,color:#000
    
    style IntA1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style IntA2 fill:#ffe0b2,stroke:#f57c00,stroke-width:2px,color:#000
    style IntA3 fill:#c8e6c9,stroke:#388e3c,stroke-width:2px,color:#000
    style IntA4 fill:#bbdefb,stroke:#1976d2,stroke-width:2px,color:#000
    
    style BiA1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style BiA2 fill:#ffe0b2,stroke:#f57c00,stroke-width:2px,color:#000
    style BiA3 fill:#f5f5f5,stroke:#999,stroke-width:2px,color:#000
    style BiA4 fill:#bbdefb,stroke:#1976d2,stroke-width:2px,color:#000
    style BiA5 fill:#f5f5f5,stroke:#999,stroke-width:2px,color:#000
    
    style UniA1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style UniA2 fill:#ffe0b2,stroke:#f57c00,stroke-width:2px,color:#000
    style UniA3 fill:#f5f5f5,stroke:#999,stroke-width:2px,color:#000
    style UniA4 fill:#f5f5f5,stroke:#999,stroke-width:2px,color:#000
    style UniA5 fill:#bbdefb,stroke:#1976d2,stroke-width:2px,color:#000
    
    style AccA1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style AccA2 fill:#ffe0b2,stroke:#f57c00,stroke-width:2px,color:#000
    style AccA3 fill:#c8e6c9,stroke:#388e3c,stroke-width:2px,color:#000
    style AccA4 fill:#bbdefb,stroke:#1976d2,stroke-width:2px,color:#000
