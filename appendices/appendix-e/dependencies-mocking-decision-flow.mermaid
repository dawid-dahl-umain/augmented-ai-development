graph TD
    %% Reference boxes (no arrows to main flow)
    Legend["📖 SYMBOLS<br/>────────<br/>**✓ Real**: Use actual dependency<br/>**⊗ Mock**: Use test double<br/>**⇄ Toggle**: Mock dev, real verify<br/>**N/A**: Not applicable"]
    
    DepTypes["🎨 DEPENDENCY TYPES<br/>────────<br/>**IPD** = In-Process Dependency<br/>**OOPD** = Out-of-Process Dependency<br/><br/>🟣 Pure IPD: No side effects<br/>🟠 Impure IPD: Internal side effects<br/>🟢 Managed OOPD: Your resources<br/>🔵 Unmanaged OOPD: External systems"]
    
    Info["💡 IMPLEMENTATION TYPES<br/>────────<br/>**Observable Behavioral**:<br/>Business logic & use cases<br/><br/>**Non-Observable Technical**:<br/>Infrastructure & adapters<br/><br/>**Observable Technical**:<br/>Pure presentation (UI/UX)"]
    
    %% Main decision flow
    Start["Should I mock this dependency?"]
    
    Start --> Q1{"What are you<br/>building?"}
    
    Q1 -->|Observable<br/>Behavioral| BehaviorSplit{"Test scope?"}
    Q1 -->|Non-Observable<br/>Technical| TechSplit{"Dependency<br/>category?"}
    Q1 -->|Observable<br/>Technical| Visual["👁️ Visual/Sensory Validation<br/>────<br/>No mocking applicable"]
    
    BehaviorSplit -->|Single unit| UnitChoice["🔬 Unit Test"]
    BehaviorSplit -->|Full system| AccChoice["🎯 Acceptance Test"]
    
    TechSplit -->|Managed OOPD| IntChoice["🔌 Integration Test"]
    TechSplit -->|Unmanaged OOPD| ContractRoute{"Governed or External?"}
    
    ContractRoute -->|Governed| BiChoice["🤝 Bidirectional Contract"]
    ContractRoute -->|External| UniChoice["➡️ Unidirectional Contract"]
    
    %% Compact answer nodes
    UnitChoice --> UnitAnswer["🔬 UNIT TEST<br/>────────<br/>🟣 Pure IPD → ✓ Real<br/>🟠 Impure IPD → ⊗ Mock<br/>🟢 Managed OOPD → ⊗ Mock<br/>🔵 Unmanaged OOPD → ⊗ Mock"]
    
    IntChoice --> IntAnswer["🔌 INTEGRATION TEST<br/>────────<br/>🟣 Pure IPD → ✓ Real<br/>🟠 Impure IPD → ✓/⊗ (if stable)*<br/>🟢 Managed OOPD → ✓ Real<br/>🔵 Unmanaged OOPD → ⊗ Mock"]
    
    BiChoice --> BiAnswer["🤝 BIDIRECTIONAL CONTRACT<br/>────────<br/>🟣 Pure IPD → ✓ Real<br/>🟠 Impure IPD → ✓/⊗ (if stable)*<br/>🟢 Managed OOPD → ⊗ Mock**<br/>🔵 Governed → ⇄ Toggle<br/>🔵 External → N/A"]
    
    UniChoice --> UniAnswer["➡️ UNIDIRECTIONAL CONTRACT<br/>────────<br/>🟣 Pure IPD → ✓ Real<br/>🟠 Impure IPD → ✓/⊗ (if stable)*<br/>🟢 Managed OOPD → ⊗ Mock**<br/>🔵 Governed → N/A<br/>🔵 External → ⇄ Toggle"]
    
    AccChoice --> AccAnswer["🎯 ACCEPTANCE TEST<br/>────────<br/>🟣 Pure IPD → ✓ Real<br/>🟠 Impure IPD → ✓ Real<br/>🟢 Managed OOPD → ✓ Real (all)<br/>🔵 Unmanaged OOPD → ⊗ Mock"]
    
    %% Footnotes
    Footnotes["* If stable and reliable<br/>** Focus on contract, not infrastructure"]
    
    %% Styling - minimal, functional only
    style Legend fill:#fff9c4,stroke:#f9a825,stroke-width:2px,color:#000
    style DepTypes fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    style Info fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style Footnotes fill:#f5f5f5,stroke:#999,stroke-width:1px,color:#666
    
    style Start fill:#f5f5f5,stroke:#333,stroke-width:3px,color:#000
    style Q1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    style BehaviorSplit fill:#fff,stroke:#666,stroke-width:1px,color:#000
    style TechSplit fill:#fff,stroke:#666,stroke-width:1px,color:#000
    style ContractRoute fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    
    style Visual fill:#f5f5f5,stroke:#999,stroke-width:2px,color:#000
    style UnitChoice fill:#fff,stroke:#333,stroke-width:2px,color:#000
    style IntChoice fill:#fff,stroke:#333,stroke-width:2px,color:#000
    style BiChoice fill:#fff,stroke:#333,stroke-width:2px,color:#000
    style UniChoice fill:#fff,stroke:#333,stroke-width:2px,color:#000
    style AccChoice fill:#fff,stroke:#333,stroke-width:2px,color:#000
    
    style UnitAnswer fill:#f5f5f5,stroke:#333,stroke-width:2px,color:#000
    style IntAnswer fill:#f5f5f5,stroke:#333,stroke-width:2px,color:#000
    style BiAnswer fill:#f5f5f5,stroke:#333,stroke-width:2px,color:#000
    style UniAnswer fill:#f5f5f5,stroke:#333,stroke-width:2px,color:#000
    style AccAnswer fill:#f5f5f5,stroke:#333,stroke-width:2px,color:#000